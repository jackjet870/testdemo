!function(){var e={options:{skip:0,top:App.settings.base.dataTakeCount,urls:{data:"/Membership/V1/Users/api/Roles",editPage:"/Membership/V1/Users/Page/RoleHeaderDetail",encrypt:"/Membership/V1/Users/api/Crypto/Encrypt"},messages:App.str.text("Messages"),strings:App.str.text("StringContents")},values:{},events:{defaults:{initialize:{},getParameters:{},setErrorFocus:{},initializeControl:{},initializeControlEvent:{},loadMasterData:{},loadData:{},loadDialogs:{},createValidator:{},validateAll:{}}},operations:{defaults:{save:{},remove:{}}},header:{options:{urls:{},validations:{},bindOption:{}},values:{},events:{defaults:{initialize:{},createFilter:{},change:{}}},operations:{defaults:{search:{}}}},detail:{options:{urls:{},validations:{},bindOption:{}},values:{},events:{defaults:{initialize:{},bindRow:{},change:{},bind:{},validateList:{},validateListCount:{},validateDetails:{}}},operations:{select:{},addNewItem:{},deleteItem:{},transfer:{},nextsearch:{}}},footer:{options:{},events:{}},dialogs:{}};e.events.defaults.initialize=function(){e.notify=App.ui.page.notify(e.events.defaults.setErrorFocus),App.ui.loading.show(),e.events.defaults.getParameters(),e.events.defaults.initializeControl(),e.events.defaults.initializeControlEvent(),e.header.events.defaults.initialize(),e.detail.events.defaults.initialize(),e.events.defaults.loadMasterData().then(function(t){return e.events.defaults.loadData()}).then(function(){return e.events.defaults.loadDialogs()}).then(function(e){}).fail(function(t){App.ui.page.normalizeError(t).forEach(function(t){e.notify.alert.message(t.message).show()})}).always(function(e){$(":input:visible:not(:disabled):first").focus(),App.ui.loading.close()})},e.events.defaults.getParameters=function(){},e.events.defaults.setErrorFocus=function(t){$(t).closest(".datatable").length?e.detail.dataTable.dataTable("setFocus",t):$(t).focus()},e.events.defaults.initializeControl=function(){var t=e.options.strings.RoleSearhListInput;$(".page-title").text(t),document.title=t},e.events.defaults.initializeControlEvent=function(){App.ui.page.applyCollapsePanel(),e.on($("#save"),"click",e.operations.defaults.save),e.on($("#search"),"click",{message:"検索処理を実行します"},e.header.operations.defaults.search)},e.events.defaults.loadMasterData=function(){return App.async.all({}).then(function(e){e.successes})},e.events.defaults.loadData=function(){return e.header.events.defaults.bind({},!0),e.detail.events.defaults.bind([],!0),App.async.success()},e.events.defaults.loadDialogs=function(){return App.async.success()},e.events.defaults.createValidator=function(t,a){return e.events.defaults.validationSuccess=e.events.defaults.validationSuccess||App.ui.page.validationSuccess(e.notify),e.events.defaults.validationFail=e.events.defaults.validationFail||App.ui.page.validationFail(e.notify),e.events.defaults.validationAlways=e.events.defaults.validationAlways||App.ui.page.validationAlways(e.notify),App.validation(t,a||{success:e.events.defaults.validationSuccess,fail:e.events.defaults.validationFail,always:e.events.defaults.validationAlways})},e.events.defaults.validateAll=function(){var t=[];return t.push(e.header.validator.validate()),t.push(e.detail.events.defaults.validateList()),App.async.all(t)},e.operations.defaults.save=function(){return App.ui.loading.show(),e.notify.alert.clear(),e.notify.info.clear(),e.detail.events.defaults.validateDetails().then(function(){var t=e.header.element.attr("data-key");e.header.data.entry(t);return $.ajax(App.ajax.webapi.post(e.options.urls.data,e.detail.data.getChangeSet())).then(function(t){e.notify.alert.clear(),e.notify.info.clear(),e.header.operations.defaults.search(),e.notify.info.message(e.options.messages.SaveCompleted).show()}).fail(function(t){var a=App.ui.page.normalizeError(t),i=a[0];if(i){if(i.errorType===App.settings.base.errorTypes.inputError)return;if(i.errorType===App.settings.base.errorTypes.conflictError)return void e.notify.alert.message(e.options.messages.UpdateConfilict+e.options.messages.RequestSearchAgain).show()}e.notify.alert.message(e.options.messages.SaveFailed).show()})}).always(function(){setTimeout(function(){e.header.element.find(":input:first").focus()},100),App.ui.loading.close()})},e.header.options.validations={},e.header.options.bindOption={appliers:{},converters:{}},e.header.events.defaults.initialize=function(){var t=$(".header");e.header.validator=t.validation(e.events.defaults.createValidator(e.header.options.validations),{immediate:!0}),e.on(t,"change",":input",e.header.events.defaults.change),e.header.element=t},e.header.events.defaults.change=function(t){var a=e.header.element,i=$(t.target),n=a.attr("data-key"),s=i.attr("data-prop"),o=e.header.data.entry(n),l=a.form().data();a.validation().validate({targets:i}).then(function(){o[s]=l[s],e.header.data.update(o)}),$("#nextsearch").is(":visible")&&($("#nextsearch").hide(),e.notify.info.message(e.options.messages.HasChangeSearchCriteria).show())},e.header.events.defaults.createFilter=function(){var t=e.header.element.form().data(),a=[];return!App.isUndefOrNull(t.RoleName)&&t.RoleName.length>0&&a.push("contains(RoleName, '"+encodeURIComponent(t.RoleName)+"') eq true"),a.join(" and ")},e.header.operations.defaults.search=function(){var t;return e.header.validator.validate().then(function(){return App.ui.loading.show(),e.notify.alert.clear(),e.options.skip=0,e.options.filter=e.header.events.defaults.createFilter(),t={url:e.options.urls.data,filter:e.options.filter,skip:e.options.skip,top:e.options.top,count:!0},$.ajax(App.ajax.webapi.get(App.data.toODataFormat(t))).then(function(t){e.detail.events.defaults.bind(t),App.ui.loading.close()},function(t){App.ui.page.normalizeError(t).forEach(function(t){e.notify.alert.message(t.message).show()}),App.ui.loading.close()})})},e.detail.options.validations={RoleName:{rules:{required:!0,maxlength:50},options:{name:"ロール名"},messages:{required:e.options.messages.Required,maxlength:e.options.messages.MaxLength}}},e.detail.options.bindOption={appliers:{}},e.detail.events.defaults.initialize=function(){var t=$(".detail"),a=t.find(".datatable"),i=a.dataTable({height:300,sortable:!0,fixedColumn:!1,innerWidth:1e3,onselect:e.detail.operations.select,onchange:e.detail.events.defaults.change,resize:!1});e.detail.validator=t.validation(e.events.defaults.createValidator(e.detail.options.validations)),e.detail.element=t,e.detail.dataTable=i;var n=App.ui.page.dataSet();e.detail.data=n,t.find(".data-take-count").text(e.options.top),e.on(t,"click","#nextsearch",e.detail.operations.nextsearch),e.on(t,"click","#add-item",e.detail.operations.addNewItem),e.on(t,"click","#del-item",e.detail.operations.deleteItem)},e.detail.events.defaults.bind=function(t,a){var i=(e.detail.element,App.ui.page.dataSet());totalCount=App.isNum(t.Count)?t.Count:"-",t=t.Items?t.Items:t,count=(t.length||0)+e.options.skip,0===e.options.skip?(i=App.ui.page.dataSet(),$("#nextsearch").hide(),e.detail.dataTable.dataTable("clear")):i=e.detail.data,e.detail.data=i,e.detail.dataTable.dataTable("addRows",t,function(t,n){(a?i.add:i.attach).bind(i)(n),t.form(e.detail.options.bindOption).bind(n),App.ui.page.applyInput(t);var s=[n.RoleId];return $.ajax(App.ajax.webapi.post(e.options.urls.encrypt,s)).then(function(a){t.find(".transfer ").attr("href",App.uri.setQuery(e.options.urls.editPage,{role_id:a[0]}))}),t}),$(".data-count").text(count),$(".data-count-total").text(totalCount),e.options.skip=count,$("#nextsearch").show(),(!App.isNum(totalCount)||totalCount<=count)&&$("#nextsearch").hide(),e.options.skip>=App.settings.base.maxSearchDataCount&&(e.notify.info.message(e.options.messages.TooManyData).show(),$("#nextsearch").hide()),e.detail.events.defaults.validateList(!0)},e.detail.events.defaults.change=function(t,a){var i=$(t.target),n=a.element.attr("data-key"),s=i.attr("data-prop"),o=e.detail.data.entry(n);e.detail.validator.validate({targets:i,state:{dataTable:e.detail.dataTable,isGridValidation:!0}}).then(function(){o[s]=a.element.form(e.detail.options.bindOption).data()[s],e.detail.data.update(o)})},e.detail.operations.nextsearch=function(){App.ui.loading.show(),e.notify.alert.clear();var t={url:e.options.urls.data,filter:e.options.filter,skip:e.options.skip,top:e.options.top,count:!0};return $.ajax(App.ajax.webapi.get(App.data.toODataFormat(t))).then(function(t){e.detail.events.defaults.bind(t),App.ui.loading.close()}).fail(function(t){App.ui.page.normalizeError(t).forEach(function(t){e.notify.alert.message(t.message).show()}),App.ui.loading.close()})},e.detail.events.defaults.validateList=function(t){var a=[];return e.detail.dataTable.dataTable("each",function(i,n){i.element.hasClass("item-tmpl")||a.push(e.detail.validator.validate({targets:i.element.find(":input"),state:{suppressMessage:t,tbody:i.element,isGridValidation:!0}}))}),App.async.all(a)},e.detail.events.defaults.validateListCount=function(){var t=0;return e.detail.dataTable.dataTable("each",function(e,a){e.element.hasClass("item-tmpl")||t++}),e.detail.data.isChanged()||0!==t?App.async.success():(e.notify.alert.message(e.options.messages.DetailRowNotFound).show(),App.async.fail())},e.detail.events.defaults.validateDetails=function(){var t=[];return t.push(e.detail.events.defaults.validateList()),t.push(e.detail.events.defaults.validateListCount()),App.async.all(t)},e.detail.operations.deleteItem=function(t){var a;return e.detail.dataTable.dataTable("lastSelectedRow",function(e){a=e}),a&&a.element?void App.ui.page.confirm({text:e.options.messages.ConfirmDeleteDetail}).then(function(){a.element.find(":input").each(function(t,a){e.notify.alert.remove(a)});var t,i=$(a.element).index(),n=0,s=0;e.detail.dataTable.dataTable("enableRowCount",function(e){s=e+2}),n=s>i?i-1:i-3,t=$(".datatable tbody:eq("+n+")"),e.detail.dataTable.dataTable("deleteRow",a.element,function(a){var i=a.attr("data-key");if(!App.isUndefOrNull(i)){var n=e.detail.data.entry(i);e.detail.data.remove(n),t.click()}})}):void e.notify.info.message(e.options.messages.RemoveNotSletcted).show()},e.detail.operations.addNewItem=function(){var t={};e.detail.data.add(t),e.detail.dataTable.dataTable("addRow",function(a){return a.form(e.detail.options.bindOption).bind(t),a.findP("RoleId").val()||a.find(".transfer").hide(),App.ui.page.applyInput(a),a},!0),e.detail.dataTable.dataTable("enableRowCount",function(e){$(".datatable tbody:eq("+e+")").click()})},e.events.setColInvalidStyle=function(e){var t,a=function(e){var i;e.hasClass("with-next-col")&&(i=t.next(),i.length&&(i.addClass("control-required"),i.removeClass("control-success"),a(i)))};t=$(e).closest("div"),t.addClass("control-required"),t.prev().addClass("control-required-label"),t.removeClass("control-success"),t.prev().removeClass("control-success-label"),a(t)},e.events.setColValidStyle=function(e){var t,a=function(e){var i;e.hasClass("with-next-col")&&(i=t.next(),i.length&&(i.removeClass("control-required"),i.addClass("control-success"),a(i)))};t=$(e).closest("div"),t.removeClass("control-required"),t.prev().removeClass("control-required-label"),t.addClass("control-success"),t.prev().addClass("control-success-label"),a(t)},e.header.events.defaults.bind=function(t,a){var i=(e.header.element,App.ui.page.dataSet());e.header.data=i,(a?i.add:i.attach).bind(i)(t),e.header.element.form().bind(t),e.header.validator.validate({state:{suppressMessage:!0}})},e.detail.events.defaults.addRow=function(t,a){e.detail.dataTable.dataTable("addRow",function(a){return a.form(e.detail.options.bindOption).bind(t),a.findP("RoleId").val()||a.find(".transfer").hide(),a},a)},e.detail.operations.select=function(t,a){e.detail.dataTable.dataTable("lastSelectedRow",function(e){e&&e.element&&e.element.removeClass("selected")}),a&&a.element&&a.element.addClass("selected")},$(document).ready(function(){e.events.defaults.initialize()}),App.ui.page.extend(e)}();