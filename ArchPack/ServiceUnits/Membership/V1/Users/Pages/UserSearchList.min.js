(function(){"use strict";var n={options:{skip:0,top:App.settings.base.dataTakeCount,urls:{search:"/Membership/V1/Users/api/Users",units:"/Membership/V1/Users/api/Units",download:"/Membership/V1/Users/api/Users/Download",editPage:"/Membership/V1/Users/Page/UserInput",encrypt:"/Membership/V1/Users/api/Crypto/Encrypt",ouputPdf:"/Membership/V1/Users/api/PdfService"},messages:App.str.text("Messages"),strings:App.str.text("StringContents")},values:{},events:{defaults:{initialize:{},getParameters:{},initializeControl:{},initializeControlEvent:{},loadMasterData:{},loadData:{},loadDialogs:{},createValidator:{},validateAll:{},transfer:{}}},operations:{defaults:{}},header:{options:{urls:{},validations:{},bindOption:{}},values:{},events:{defaults:{initialize:{},createFilter:{},change:{}}},operations:{defaults:{search:{}}}},detail:{options:{bindOption:{}},values:{},events:{defaults:{initialize:{},bind:{}}},operations:{defaults:{select:{},nextsearch:{}}}},dialogs:{}};n.events.defaults.initialize=function(){var t=$.Deferred();return n.notify=App.ui.page.notify(),App.ui.loading.show(),n.events.defaults.getParameters(),n.events.defaults.initializeControl(),n.events.defaults.initializeControlEvent(),n.header.events.defaults.initialize(),n.detail.events.defaults.initialize(),n.events.defaults.loadMasterData().then(function(){return n.events.defaults.loadData()}).then(function(){return n.events.defaults.loadDialogs()}).then(function(){}).fail(function(t){App.ui.page.normalizeError(t).forEach(function(t){n.notify.alert.message(t.message).show()})}).always(function(){$(":input:visible:not(:disabled):first").focus();App.ui.loading.close();t.resolve()}),t.promise()};n.events.defaults.getParameters=function(){};n.events.defaults.initializeControl=function(){var t=n.options.strings.UserSearchList;$(".page-title").text(t);document.title=t};n.events.defaults.initializeControlEvent=function(){App.ui.page.applyCollapsePanel();var t=$(".commands");t.on("click",".add",n.events.defaults.transfer);t.on("click",".search",n.header.operations.defaults.search);t.on("click",".download",n.header.operations.defaults.download);t.on("click",".ouputPdf",n.header.operations.defaults.ouputPdf)};n.header.operations.defaults.download=function(){var t=App.data.toODataFormat({url:n.options.urls.download,filter:n.options.filter,skip:0,top:n.options.top,count:!0}),i=App.download.downloadfile({url:App.str.format(t)})};n.header.operations.defaults.ouputPdf=function(){App.download.downloadfile({url:App.uri.setQuery(n.options.urls.ouputPdf,{documentId:"",dataGroups:[]})})};n.events.defaults.loadMasterData=function(){return App.async.all({units:$.ajax(App.ajax.webapi.get(n.options.urls.units))}).then(function(n){var t=n.successes;App.ui.util.appendOptions({target:$.findP("UnitId"),data:t.units,useEmpty:!0,reviver:function(n){return{value:n.UnitId,display:n.UnitName}}})})};n.events.defaults.loadData=function(){return App.async.success()};n.events.defaults.loadDialogs=function(){return App.async.all({}).then(function(){})};n.events.defaults.createValidator=function(t,i){return n.events.defaults.validationSuccess=n.events.defaults.validationSuccess||App.ui.page.validationSuccess(n.notify),n.events.defaults.validationFail=n.events.defaults.validationFail||App.ui.page.validationFail(n.notify),n.events.defaults.validationAlways=n.events.defaults.validationAlways||App.ui.page.validationAlways(n.notify),App.validation(t,i||{success:n.events.defaults.validationSuccess,fail:n.events.defaults.validationFail,always:n.events.defaults.validationAlways})};n.events.defaults.transfer=function(){var t;t=App.uri.setQuery(n.options.urls.editPage,{});App.ui.util.openNewWindow(t)};n.header.options.validations={UserName:{rules:{maxlength:50},options:{name:n.options.strings.UserName}}};n.header.options.bindOption={appliers:{},converters:{}};n.header.events.defaults.initialize=function(){var t=$(".header");n.header.validator=t.validation(n.events.defaults.createValidator(n.header.options.validations),{immediate:!0});n.header.element=t;App.ui.page.applyInput(t);n.on(t,"change",":input",n.header.events.defaults.change);n.on(t,"click",":checkbox",n.header.events.defaults.change)};n.header.events.defaults.change=function(){$("#nextsearch").is(":visible")&&($("#nextsearch").hide(),n.notify.info.message(n.options.messages.ChangeSearchCriteria).show())};n.header.events.defaults.createFilter=function(){var t=n.header.element.form(n.header.options.bindOption).data(),i=[];return!App.isUndefOrNull(t.UserName)&&t.UserName.length>0&&i.push("contains(UserName, '"+encodeURIComponent(t.UserName)+"') eq true"),!App.isUndefOrNull(t.Mail)&&t.Mail.length>0&&i.push("contains(Email, '"+encodeURIComponent(t.Mail)+"') eq true"),!App.isUndefOrNull(t.LastName)&&t.LastName.length>0&&i.push("contains(LastName, '"+encodeURIComponent(t.LastName)+"') eq true"),!App.isUndefOrNull(t.FirstName)&&t.FirstName.length>0&&i.push("contains(FirstName, '"+encodeURIComponent(t.FirstName)+"') eq true"),!App.isUndefOrNull(t.UnitId)&&t.UnitId.length>0&&i.push("UnitId eq "+t.UnitId),i.join(" and ")};n.header.operations.defaults.search=function(){return n.header.validator.validate().then(function(){var t;return App.ui.loading.show(),n.notify.alert.clear(),n.options.skip=0,n.options.filter=n.header.events.defaults.createFilter(),t=App.data.toODataFormat({url:n.options.urls.search,filter:n.options.filter,skip:n.options.skip,top:n.options.top,count:!0}),$.ajax(App.ajax.webapi.get(t)).then(function(t){n.detail.events.defaults.bind(t);App.ui.loading.close()},function(t){App.ui.page.normalizeError(t).forEach(function(t){n.notify.alert.message(t.message).show()});App.ui.loading.close()})})};n.detail.options.bindOption={appliers:{}};n.detail.events.defaults.initialize=function(){var t=$(".detail"),i=t.find(".datatable").dataTable({height:300,sortable:!0,innerWidth:1e3,resize:!1});n.detail.element=t;n.detail.dataTable=i;n.on(t,"click","#nextsearch",n.detail.operations.defaults.nextsearch);t.find(".data-take-count").text(n.options.top)};n.detail.events.defaults.bind=function(t,i){var u,f,r;t&&(f=App.isNum(t.Count)?t.Count:"-",t=t.Items||t,u=(t.length||0)+n.options.skip,n.options.skip===0?(r=App.ui.page.dataSet(),n.detail.dataTable.dataTable("clear")):r=n.detail.data,n.detail.data=r,n.detail.dataTable.dataTable("addRows",t,function(t,u){var f={user_id:u.UserId};return(i?r.add:r.attach).bind(r)(u),t.form(n.detail.options.bindOption).bind(u),t}),$(".data-count").text(u),$(".data-count-total").text(f),n.options.skip=u,$("#nextsearch").show(),(!App.isNum(f)||f<=u)&&$("#nextsearch").hide(),n.options.skip>=App.settings.base.maxSearchDataCount&&(n.notify.info.message(n.options.messages.TooManyData).show(),$("#nextsearch").hide()))};n.detail.operations.defaults.nextsearch=function(){var t;return App.ui.loading.show(),n.notify.alert.clear(),t=App.data.toODataFormat({url:n.options.urls.search,filter:n.options.filter,skip:n.options.skip,top:n.options.top,count:!0}),$.ajax(App.ajax.webapi.get(t)).then(function(t){n.detail.events.defaults.bind(t);App.ui.loading.close()},function(t){App.ui.page.normalizeError(t).forEach(function(t){n.notify.alert.message(t.message).show()});App.ui.loading.close()})};$(document).ready(function(){App.page.mode==="test"?App.page.test.run=function(){n.events.defaults.initialize().then(function(){jasmine.getGlobal().page=n;jasmine.getEnv().execute()})}:n.events.defaults.initialize()});App.ui.page.extend(n)})();
//# sourceMappingURL=UserSearchList.min.js.map
